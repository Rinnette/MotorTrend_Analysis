---
title: "Determining whether automatic or manual transmission is better for MPG"
author: "Rinnette N. Ramdhanie"
date: "19 December 2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r addLibrary}
        library(dplyr)
        library(ggplot2)
        library(caret)
        library(olsrr)
```

```{r setupData}
        data(mtcars)
        m <- mtcars
       # m$am = factor(m$am, levels = c("Automatic", "Manual"))
        
       # m <- mutate(m, Transmission = factor(m$am))
      #  levels(m$Transmission) = c("Automatic", "Manual")
```

## Executive Summary

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## Exploratory data analysis
Checked the structure, summary and distribution of the transmission types.

```{r}
        str(m)
        summary(m$mpg)
        table (m$am)
```


Checked the summary of *mpg*.  Also separated the data in two groups by transmission type and checked the summary for each group.

A boxplot of the data was done on mpg and transmission type.

```{r boxplotAM}
        ## include main heading and resize
        m <- mutate(m, Transmission = factor(m$am))
        levels(m$Transmission) = c("Automatic", "Manual")

        #m$am = factor(m$am)
        ggplot(m, aes(x=Transmission, y=mpg, fill = Transmission)) + geom_boxplot()

```

The boxplot is showing that genarally manual cars get higher MPG than automatic cars.



## Model selection and strategy
In the initial model the outcome is continuous and the predictor is a factor variable, therefore linear regression was used.


## Model 1 - Linear regression using a single predictor
A linear regression was used with *mpg* as the outcome and *am* the predictor.

```{r lmModel, echo = TRUE}
        m$am = factor(m$am)
        m1 <- lm(mpg ~ am, m)
        summary(m1)
```

### Interpretation of coefficients
The expected MPG of cars with an automatic transmission is $17.15$ while that of cars with a manual transmission is $17.15 + 7.24 = 24.38$

The Adjusted R-squared value is 0.339 which means that in this model only about 34% of the variation in the *mpg* is explained by the variation in *am*.



### Consideraing other variables as predictors
The correlation coefficients were checked to see how *mpg* varies with the other variables in the dataset.

```{r checkCorr}
        cor(mtcars$mpg, mtcars)
```

The variables *cyl*, *wt*, *disp*, *hp*, *drat* and *vs* show the highest correlation coefficients.


A pairs plot was done for these variables.

```{r fPlot}
        featurePlot(x=m[, c("cyl", "wt", "disp", "hp", "drat", "vs")], y=m$mpg, 
                    plot="pairs")
```

Looking at the first row, the scatter plots show strong relationships of varying degrees between *mpg* and *cyl*, *wt*, *disp*, *hp*, *drat* and *vs* (listed in order with *cyl* being the strongest).

The following models were built with corresponding predictors:

* m2: *am* + *cyl*
* m3: *am* + *cyl* + *wt*
* m4: *am* + *cyl* + *wt* + *disp*
* m5: *am* + *cyl* + *wt* + *disp* + *hp*
* m6: *am* + *cyl* + *wt* + *disp* + *hp* + *drat*
* m7: *am* + *cyl* + *wt* + *disp* + *hp* + *drat* + *vs*

```{r}
        m$cyl <- factor(m$cyl)
        m$vs <- factor(m$vs)
        m2 <- update(m1, .~. + cyl)
        m3 <- update(m2, .~. + wt)
        m4 <- update(m3, .~. + disp)
        m5 <- update(m4, .~. + hp)
        m6 <- update(m5, .~. + drat)
        m7 <- update(m6, .~. + vs)
        
        mnames <- c("m1", "m2", "m3", "m4", "m5", "m6", "m7")
        mAR2s <- c(summary(m1)$adj.r.squared, summary(m2)$adj.r.squared, 
                   summary(m3)$adj.r.squared, summary(m4)$adj.r.squared, 
                   summary(m5)$adj.r.squared, summary(m6)$adj.r.squared, 
                   summary(m7)$adj.r.squared)
        
        data.frame(Model = mnames, AdjRSquared = mAR2s)
```

The table shows figures for the adjusted R-squared values for each model.  The values increase after each predictor is added until *drat* was added.  Model **m5** therefore shows the highest adjusted r-squared of about 83% so this will be used as the final model.

## Check whether inclusions were necessary
The anova function was used to check whether the inclusion of each predictor was necessary.

```{r}
        anova(m1, m2, m3, m4, m5)
```

Looking at the F statistic and the associated p values, we can see that the inclusion of *cyl*, *wt* and *hp* appeared to be necessary, while the inclusion on the *disp* predictor appeared to have been unnessary as the value 0.89 is greater than 0.05

## Residuals and Diagnostics
Plotting residuals and fitted values.

```{r plotResid}
        par(mfrow = c(1,2))        
        plot(m5, which = 1)
        plot(m5, which = 2)
```
The residuals are more or less on the zero line - there is some slight variation.  In the Normal Q-Q plot, since the points are almost all along the diagonal, this shows that the residuals are approximately normally distributed with mean 0 and standard deviation of 1.

There are also some outliers shown, particularly Toyota Corolla and Fiat 128 which appears in both plots.  To determine how influential these are to the prediction model, some regression diagnostics were checked.

```{r diagPlots}
       # par(mfrow = c(2,2))
        ols_plot_dffits(m5)
        ols_plot_resid_stud(m5)
       # ols_plot_resid_stud_fit(m5)
       # ols_plot_resid_stand(m5)
```




### Checking significance in difference of group means
We assess the significance in the difference of the group means by using a two-tailed test where $H_0: \beta_1 = 0$ and $H_a: \beta_1 > 0$.

Since the $t$ $value = 4.11 > 1.96$,  we reject $H_0$  at a $5\%$ level of significance.  The same conclusion results when using the $p-value = 0.00029 < 0.05$ showing that there is a statistically significant difference in the group means.























## Two-way ANOVA



```{r}
        model2 <- aov(mpg ~ am, m)
        summary(model2)
```

Since the $p-value = 0.00029 < 0.05$, transmission type is statistically significant and affects MPG.

